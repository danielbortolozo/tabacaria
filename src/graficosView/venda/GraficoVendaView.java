/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package graficosView.venda;

import dao.CaixaDAO;
import java.io.InputStream;
import java.math.BigDecimal;
import java.math.BigInteger;
import java.text.DateFormat;
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.time.LocalDate;
import java.time.Month;
import java.time.format.DateTimeFormatter;

import java.util.ArrayList;
import java.util.Date;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.swing.JOptionPane;

import net.sf.jasperreports.engine.JRException;
import net.sf.jasperreports.engine.JasperFillManager;
import net.sf.jasperreports.engine.JasperPrint;
import net.sf.jasperreports.engine.data.JRBeanCollectionDataSource;
import net.sf.jasperreports.view.JasperViewer;

/**
 *
 * @author daniel
 */
public class GraficoVendaView extends javax.swing.JFrame {

    /**
     * Creates new form graficoVendaView
     */
    SimpleDateFormat sdf = new SimpleDateFormat ("dd/MM/yyyy");
    public GraficoVendaView() {
        initComponents();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jButton1 = new javax.swing.JButton();
        jLabel1 = new javax.swing.JLabel();
        jLabel2 = new javax.swing.JLabel();
        jcbMes = new javax.swing.JComboBox<>();
        jLabel3 = new javax.swing.JLabel();
        jcbAno = new javax.swing.JComboBox<>();

        setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);
        setTitle("Gráfico de Faturamento");

        jButton1.setIcon(new javax.swing.ImageIcon(getClass().getResource("/imagens/3d bar chart.png"))); // NOI18N
        jButton1.setText("Gerar Gráfico");
        jButton1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton1ActionPerformed(evt);
            }
        });

        jLabel1.setFont(new java.awt.Font("Ubuntu", 1, 24)); // NOI18N
        jLabel1.setText("Gráfico de Faturamento ");

        jLabel2.setText("Mês");

        jcbMes.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "JANEIRO", "FEVEREIRO", "MARÇO", "ABRIL ", "MAIO", "JUNHO", "JULHO", "AGOSTO", "SETEMBRO", "OUTUBRO", "NOVEMBRO", "DEZEMBRO" }));

        jLabel3.setText("Ano");

        jcbAno.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "2015", "2016", "2017", "2018", "2019", "2020", "2021", "2022", "2023", "2024", "2025", "2026", "2027", "2028", "2029", "2030" }));

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addComponent(jLabel3)
                    .addComponent(jLabel2)
                    .addComponent(jLabel1, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(jcbMes, 0, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(jcbAno, 0, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(jButton1, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jLabel1)
                .addGap(18, 18, 18)
                .addComponent(jLabel2)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(jcbMes, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(18, 18, 18)
                .addComponent(jLabel3)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jcbAno, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(18, 18, 18)
                .addComponent(jButton1)
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void jButton1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton1ActionPerformed



       CaixaDAO caixaDao = new CaixaDAO();
        try {
            List<Object[]> listaVenda = new ArrayList<>();
            
            String mes = null;
            String ano = null;
            String data1 = null, data2 = null;
            ano = jcbAno.getSelectedItem().toString();
            if(jcbMes.getSelectedItem().equals("JANEIRO")){
                data1 = "01/01/"+ano;
                data2 = "31/01/"+ano;               
            }else
                if (jcbMes.getSelectedItem().equals("FEVEREIRO")){
                    data1 = "01/02/"+ano;
                    data2 = "30/02/"+ano;
                }else
                    if (jcbMes.getSelectedItem().equals("MARÇO")){
                       data1 = "01/03/"+ano;
                       data2 = "31/03/"+ano;
                    }else
                        if (jcbMes.getSelectedItem().equals("ABRIL")){
                           data1 = "01/04/"+ano;
                           data2 = "30/04/"+ano;
                        }else
                            if (jcbMes.getSelectedItem().equals("MAIO")){
                               data1 = "01/05/"+ano;
                               data2 = "31/05/"+ano;
                            }else
                                if (jcbMes.getSelectedItem().equals("JUNHO")){
                                   data1 = "01/06/"+ano;
                                   data2 = "30/06/"+ano;
                                }else
                                    if (jcbMes.getSelectedItem().equals("JULHO")){
                                        data1 = "01/07/"+ano;
                                        data2 = "31/07/"+ano;
                                    }else
                                        if (jcbMes.getSelectedItem().equals("AGOSTO")){
                                           data1 = "01/08/"+ano;
                                           data2 = "31/08/"+ano;
                                        }else
                                            if (jcbMes.getSelectedItem().equals("SETEMBRO")){
                                               data1 = "01/09/"+ano;
                                               data2 = "30/09/"+ano;
                                            }else
                                                if (jcbMes.getSelectedItem().equals("OUTUBRO")){
                                                   data1 = "01/10/"+ano;
                                                   data2 = "31/10/"+ano;
                                                }else
                                                    if (jcbMes.getSelectedItem().equals("NOVEMBRO")){
                                                       data1 = "01/11/"+ano;
                                                       data2 = "30/11/"+ano;
                                                    }else
                                                        if (jcbMes.getSelectedItem().equals("DEZEMBRO")){
                                                           data1 = "01/12/"+ano;
                                                           data2 = "31/12/"+ano;
                                                        }      
            
            
            System.out.println("data 1 ="+data1);
            System.out.println("data 1 ="+data2);
                   
                                   
            listaVenda = caixaDao.listaPeriodoCaixaTotalEntrada(sdf.parse(data1), sdf.parse(data2));
            
            if (listaVenda.isEmpty()){
                JOptionPane.showMessageDialog(null, "Não teve Faturamento neste Mês");
                return;
            }
            
            
            List<GraficoVendasMes> listaGrafVendas = new ArrayList<>();
            GraficoVendasMes vendas = new GraficoVendasMes();
                     
            LocalDate dtLocal;
            DateTimeFormatter formatador = DateTimeFormatter.ofPattern("dd/MM/yyyy");        
            BigDecimal faturamento = new BigDecimal(BigInteger.ZERO);
            String aux = null;
            int i = 0;
            for (Object[] o:listaVenda){
                aux = o[0].toString();
                dtLocal = LocalDate.parse(aux);
                vendas.setData(sdf.parse(dtLocal.format(formatador)));
                vendas.setTotal(new BigDecimal(o[1].toString()));
                vendas.setDias(String.valueOf(dtLocal.getDayOfMonth()));
                faturamento = (faturamento.add(vendas.getTotal()));
                                             
                listaGrafVendas.add(new GraficoVendasMes(vendas.getData(),vendas.getTotal(),vendas.getDias()));
                i = (i + 1);                
            }         
            
        Map parametros = new HashMap();

        parametros.put("mes", jcbMes.getSelectedItem().toString());  
        parametros.put("faturamento", faturamento);
        parametros.put("totalDias", String.valueOf(i));
        
        InputStream is = getClass().getResourceAsStream("grafico.jasper");              
        
           
        JRBeanCollectionDataSource relat = new JRBeanCollectionDataSource(listaGrafVendas);
        JasperPrint jp = null;
           try {
               jp = JasperFillManager.fillReport(is, parametros, relat);
           } catch (JRException ex) {
               Logger.getLogger(GraficoVendaView.class.getName()).log(Level.SEVERE, null, ex);
           }
        JasperViewer jv = new JasperViewer(jp, false);
        jv.setDefaultCloseOperation(JasperViewer.DISPOSE_ON_CLOSE);
        jv.setVisible(true);  
            
            
            
            
            
//        
        } catch (ParseException ex) {
            Logger.getLogger(GraficoVendaView.class.getName()).log(Level.SEVERE, null, ex);
        } 
        
        
    }//GEN-LAST:event_jButton1ActionPerformed

    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
         */
        try {
            for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
                if ("Nimbus".equals(info.getName())) {
                    javax.swing.UIManager.setLookAndFeel(info.getClassName());
                    break;
                }
            }
        } catch (ClassNotFoundException ex) {
            java.util.logging.Logger.getLogger(GraficoVendaView.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (InstantiationException ex) {
            java.util.logging.Logger.getLogger(GraficoVendaView.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (IllegalAccessException ex) {
            java.util.logging.Logger.getLogger(GraficoVendaView.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (javax.swing.UnsupportedLookAndFeelException ex) {
            java.util.logging.Logger.getLogger(GraficoVendaView.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
        //</editor-fold>
        //</editor-fold>

        /* Create and display the form */
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                new GraficoVendaView().setVisible(true);
            }
        });
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton jButton1;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JComboBox<String> jcbAno;
    private javax.swing.JComboBox<String> jcbMes;
    // End of variables declaration//GEN-END:variables
}
